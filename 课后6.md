# æ‰€æœ‰æƒ

ä¸»è¦æœ‰ 3 ç§æµæ´¾

- åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆGabage Collectionï¼‰Javaï¼ŒGo
- æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼ˆManual Memory Managementï¼‰Cï¼ŒC++
- é€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿç®¡ç†å†…å­˜ï¼ˆOwnership Systemï¼‰Rust

```rust
int* foo() {
    int a;          // å˜é‡açš„ä½œç”¨åŸŸå¼€å§‹
    a = 100;
    char *c = "xyz";   // å˜é‡cçš„ä½œç”¨åŸŸå¼€å§‹
    return &a;
}                   // å˜é‡aå’Œcçš„ä½œç”¨åŸŸç»“æŸ

```

ä¸ºä»€ä¹ˆä¸Šé¢çš„ä»£ç ä¸å®‰å…¨ï¼Ÿ

- var a å’Œ var c éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œæ„å‘³ç€åœ¨å‡½æ•°ç»“æŸåŽä¼šè¢«é‡Šæ”¾
- ç¦»å¼€ä½œç”¨åŸŸåŽï¼Œå±€éƒ¨å˜é‡ä¼šè¢«é‡Šæ”¾ï¼Œä»Žè€Œå¯¼è‡´æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜è¢«é‡Šæ”¾ã€‚é€ æˆæ‚¬åž‚æŒ‡é’ˆï¼ˆDangling Pointerï¼‰çš„é—®é¢˜ã€‚
- å…¶æ¬¡ var c æŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ‰€ä»¥ä¸ä¼šè¢«é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´â€œxyzâ€æ˜¯å¸¸é‡ï¼Œè€Œä¸æ˜¯å˜é‡ã€‚åªæœ‰åœ¨ç¨‹åºç»“æŸåŽæ‰ä¼šè¢«é‡Šæ”¾ã€‚

æ ˆå’Œå †

- æ ˆï¼ˆStackï¼‰ï¼šåŽè¿›å…ˆå‡ºï¼Œå…ˆè¿›åŽå‡º
- å †ï¼ˆHeapï¼‰ï¼šåŠ¨æ€åˆ†é…å†…å­˜ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾

æ ˆ

- æŒ‰ç…§é¡ºåºå­˜å‚¨æ•°æ®ï¼ŒåŽè¿›å…ˆå‡º
- é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å®¹é‡å°
- é€šå¸¸ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡
- éœ€è¦çŸ¥é“æ•°æ®å¤§å°ï¼Œä¸ç„¶æ— æ³•åˆ†é…å†…å­˜

å †

- æŒ‰ç…§ä»»æ„é¡ºåºå­˜å‚¨æ•°æ®ï¼Œæ²¡æœ‰é¡ºåº
- é€Ÿåº¦æ…¢ï¼Œä½†æ˜¯å®¹é‡å¤§
- éœ€è¦è¯·æ±‚å†…å­˜ï¼Œç„¶åŽæ“ä½œç³»ç»Ÿä¼šå¯»æ‰¾åˆé€‚çš„ä½ç½®åˆ†é…å†…å­˜ï¼Œç„¶åŽè¿”å›žä¸€ä¸ªæŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯åˆ†é…ã€‚
- ç”±äºŽæŒ‡é’ˆçš„å­˜åœ¨ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶å¯ä»¥ç›´æŽ¥ä½¿ç”¨æŒ‡é’ˆï¼Œè€Œä¸éœ€è¦çŸ¥é“æ•°æ®å¤§å°ï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€åˆ†é…å†…å­˜ã€‚

æ€§èƒ½åŒºåˆ«

- æ ˆï¼šé€Ÿåº¦å¿«ï¼Œå®¹é‡å°
- å †ï¼šé€Ÿåº¦æ…¢ï¼Œå®¹é‡å¤§
- æ ˆçš„æ•°æ®å¤§å°å¿…é¡»æ˜¯ç¡®å®šçš„ï¼Œè€Œå †çš„æ•°æ®å¤§å°å¯ä»¥æ˜¯ä»»æ„çš„
- æ ˆçš„æ•°æ®å¯ä»¥å¤åˆ¶ï¼Œè€Œå †çš„æ•°æ®åªèƒ½ç§»åŠ¨

æ‰€æœ‰æƒåŽŸåˆ™
ç†è§£äº†å †æ ˆï¼ŒæŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å…³äºŽæ‰€æœ‰æƒçš„è§„åˆ™ï¼Œé¦–å…ˆè¯·è°¨è®°ä»¥ä¸‹è§„åˆ™ï¼š

- Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…
- ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop)

å˜é‡ä½œç”¨åŸŸ

- å˜é‡ä½œç”¨åŸŸï¼ˆScopeï¼‰ï¼šå˜é‡çš„ä½œç”¨èŒƒå›´
- å˜é‡ä½œç”¨åŸŸå¼€å§‹äºŽå˜é‡å£°æ˜Žï¼Œä¸€ç›´æŒç»­åˆ°å½“å‰è¯­å¥å—ç»“æŸ
- è¯­å¥å—ï¼ˆBlockï¼‰ï¼šç”±ä¸€å¯¹èŠ±æ‹¬å·åŒ…è£¹çš„ä»£ç 
- è¯­å¥å—å¯ä»¥åµŒå¥—ï¼Œå†…å±‚è¯­å¥å—çš„ä½œç”¨åŸŸåœ¨å¤–å±‚è¯­å¥å—ä¹‹å†…

```rust
fn main() {
    let a = 100;    // å˜é‡açš„ä½œç”¨åŸŸå¼€å§‹
    {               // è¯­å¥å—å¼€å§‹
        let b = 200;    // å˜é‡bçš„ä½œç”¨åŸŸå¼€å§‹
        println!("a = {}, b = {}", a, b);
    }               // å˜é‡bçš„ä½œç”¨åŸŸç»“æŸ
    println!("a = {}", a);
}                   // å˜é‡açš„ä½œç”¨åŸŸç»“æŸ
```

æ‰€æœ‰æƒè½¬ç§»

- è‡ªåŠ¨æ‹·è´çš„æ–¹å¼æ¥èµ‹å€¼å˜é‡
- æ‰€æœ‰æƒè½¬ç§»ï¼ˆOwnership Transferï¼‰ï¼šå°†å€¼ä»Žä¸€ä¸ªå˜é‡è½¬ç§»åˆ°å¦ä¸€ä¸ªå˜é‡
- æ‰€æœ‰æƒè½¬ç§»å‘ç”Ÿåœ¨èµ‹å€¼è¯­å¥ä¸­
- æ‰€æœ‰æƒè½¬ç§»çš„å‰ææ˜¯ä¸¤ä¸ªå˜é‡çš„ç±»åž‹å¿…é¡»ç›¸åŒ
- æ‰€æœ‰æƒè½¬ç§»åŽï¼Œå˜é‡ a å°†æ— æ³•å†ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå·²ç»ä¸å†æ‹¥æœ‰å€¼ 100 äº†

```rust
fn main() {
    let a = 100;    // å˜é‡açš„ä½œç”¨åŸŸå¼€å§‹
    let b = a;      // æ‰€æœ‰æƒè½¬ç§»
    println!("a = {}, b = {}", a, b);
}                   // å˜é‡aå’Œbçš„ä½œç”¨åŸŸç»“æŸ
```

```rust
let s1 = String::from("hello");
let s2 = s1;
```

- s1 å’Œ s2 éƒ½æŒ‡å‘åŒä¸€å—å†…å­˜
- s1 å’Œ s2 éƒ½æ˜¯æœ‰æ•ˆçš„
- s1 å’Œ s2 éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œæ‰€ä»¥ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¼šé‡Šæ”¾ä¸¤æ¬¡å†…å­˜ï¼Œé€ æˆâ€œäºŒæ¬¡é‡Šæ”¾â€çš„é—®é¢˜
- äºŒæ¬¡é‡Šæ”¾ï¼ˆDouble Freeï¼‰ï¼šåŒä¸€å—å†…å­˜è¢«é‡Šæ”¾ä¸¤æ¬¡ã€‚s1 å’Œ s2 éƒ½æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œæ‰€ä»¥ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¼šé‡Šæ”¾ä¸¤æ¬¡å†…å­˜ï¼Œé€ æˆâ€œäºŒæ¬¡é‡Šæ”¾â€çš„é—®é¢˜

String æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»“æž„ä½“ï¼Œå®ƒåŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼š

- æŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆ
- é•¿åº¦
- å®¹é‡

å…¶ä¸­ï¼ŒæŒ‡é’ˆæŒ‡å‘å †å†…å­˜ï¼Œé•¿åº¦å’Œå®¹é‡éƒ½æ˜¯æŒ‡é’ˆæ‰€æŒ‡å‘çš„å †å†…å­˜çš„é•¿åº¦å’Œå®¹é‡ã€‚

å½“ s1 èµ‹äºˆ s2 åŽï¼ŒRust è®¤ä¸º s1 ä¸å†æœ‰æ•ˆï¼Œå› æ­¤ä¹Ÿæ— éœ€åœ¨ s1 ç¦»å¼€ä½œç”¨åŸŸåŽ drop ä»»ä½•ä¸œè¥¿ï¼Œè¿™å°±æ˜¯æŠŠæ‰€æœ‰æƒä»Ž s1 è½¬ç§»ç»™äº† s2ï¼Œs1 åœ¨è¢«èµ‹äºˆ s2 åŽå°±é©¬ä¸Šå¤±æ•ˆäº†

æµ…æ‹·è´

- æµ…æ‹·è´ï¼ˆShallow Copyï¼‰ï¼šåªå¤åˆ¶æŒ‡é’ˆï¼Œè€Œä¸å¤åˆ¶å †å†…å­˜
- æµ…æ‹·è´ä¸ä¼šé€ æˆäºŒæ¬¡é‡Šæ”¾çš„é—®é¢˜ï¼Œå› ä¸º s1 å’Œ s2 æŒ‡å‘çš„æ˜¯åŒä¸€å—å †å†…å­˜ï¼Œæ‰€ä»¥ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œåªä¼šé‡Šæ”¾ä¸€æ¬¡å†…å­˜

```rust
let x = 5;
let y = x;

println!("x = {}, y = {}", x, y);
```

æ·±æ‹·è´

- æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ï¼šä¸ä»…å¤åˆ¶æŒ‡é’ˆï¼Œè¿˜ä¼šå¤åˆ¶å †å†…å­˜
- æ·±æ‹·è´ä¼šé€ æˆèµ„æºæµªè´¹ï¼Œå› ä¸º s1 å’Œ s2 æŒ‡å‘çš„æ˜¯ä¸åŒçš„å †å†…å­˜ï¼Œæ‰€ä»¥ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¼šé‡Šæ”¾ä¸¤æ¬¡å†…å­˜ï¼Œé€ æˆèµ„æºæµªè´¹çš„é—®é¢˜

```rust
let s1 = String::from("hello");
let s2 = s1.clone();

println!("s1 = {}, s2 = {}", s1, s2);
```

# ä¹ é¢˜

1. ðŸŒŸðŸŒŸ

```rust

fn main() {
    // ä½¿ç”¨å°½å¯èƒ½å¤šçš„æ–¹æ³•æ¥é€šè¿‡ç¼–è¯‘
    let x = String::from("hello, world");
    let y = x.clone();
    println!("{},{}",x,y);
}
```

2. ðŸŒŸðŸŒŸ

```rust
fn main() {
    let s1 = String::from("hello, world");
    let s2 = take_ownership(s1);

    println!("{}", s2);
}

// åªèƒ½ä¿®æ”¹ä¸‹é¢çš„ä»£ç !
fn take_ownership(s: String) -> String {
    let s1 = s;
    println!("{}", s1);
    return s1;
}
```

3. ðŸŒŸðŸŒŸ

```rust

fn main() {
    let s = give_ownership();
    println!("{}", s);
}

// åªèƒ½ä¿®æ”¹ä¸‹é¢çš„ä»£ç !
fn give_ownership() -> String {
    let s = String::from("hello, world");
    // convert String to Vec
    // å°† String è½¬æ¢æˆ Vec ç±»åž‹
    let _s = s.into_bytes();
    s
}
```

4. ðŸŒŸðŸŒŸ

```rust
fn main() {
    let s = String::from("hello, world");

    print_str(s.clone());

    println!("{}", s);
}

fn print_str(s: String)  {
    println!("{}",s)
}
```

5. ðŸŒŸðŸŒŸ

```rust
// ä¸è¦ä½¿ç”¨ cloneï¼Œä½¿ç”¨ copy çš„æ–¹å¼æ›¿ä»£
fn main() {
    let x = (1, 2, (), "hello");
    let y = x;
    println!("{:?}, {:?}", x, y);
}
```

6. ðŸŒŸðŸŒŸ

```rust

fn main() {
    let s = String::from("hello, ");

    // åªä¿®æ”¹ä¸‹é¢è¿™è¡Œä»£ç  !
    let mut s1 = s;

    s1.push_str("world");

    println!("{}", s1);
}
```

7. ðŸŒŸðŸŒŸ

```rust

fn main() {
    let x = Box::new(5);

    let mut y = Box::new(4);     // å®Œæˆè¯¥è¡Œä»£ç ï¼Œä¸è¦ä¿®æ”¹å…¶å®ƒè¡Œï¼

    *y = 4;

    assert_eq!(*x, 5);
}
```

8. ðŸŒŸðŸŒŸ

```rust

fn main() {
   let t = (String::from("hello"), String::from("world"));

   let _s = t.0;

   // ä»…ä¿®æ”¹ä¸‹é¢è¿™è¡Œä»£ç ï¼Œä¸”ä¸è¦ä½¿ç”¨ `_s`
   println!("{:?}", t);
}
```

9. ðŸŒŸðŸŒŸ

```rust

fn main() {
   let t = (String::from("hello"), String::from("world"));

   // å¡«ç©ºï¼Œä¸è¦ä¿®æ”¹å…¶å®ƒä»£ç 
   let (s1, s2) = t.clone();

   println!("{:?}, {:?}, {:?}", s1, s2, t); // -> "hello", "world", ("hello", "world")
}
```
