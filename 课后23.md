# 认识生命周期

生命周期 = 引用的有效作用域

- 编译器大部分大部分时候可以自动推导类型，编译器大多数时间也可以自动推导生命周期。
- 在多种类型存在时，编译器会报错，需要手动指定生命周期。

悬垂指针和生命周期

- 悬垂指针：指针指向的内存已经被释放。
- Rust 编译器会在编译时检查悬垂指针。
- 生命周期的引入，可以让编译器在编译时检查悬垂指针。

```rust
fn main() {
    let r;
    {
        let x = 5;
        r = &x;
    }
    println!("r: {}", r);
}
```

上面的代码会报错，因为 `x` 的生命周期已经结束，`r` 指向的内存已经被释放。

借用检查

- 为了确保 Rust 的所有权和借用的正确性，借用检查器（borrow checker）
- 借用检查器会在编译时检查引用的有效性。
- 编译通过，很简单，只要‘b 比 ’a 大就好。

## 函数中的生命周期

```rust
fn longest(x: &str, y: &str) -> &str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

上面的代码会报错，因为编译器无法确定返回的引用的生命周期。

```rust